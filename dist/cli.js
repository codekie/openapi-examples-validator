#!/usr/bin/env node
module.exports=function(e){var t={};function a(n){if(t[n])return t[n].exports;var r=t[n]={i:n,l:!1,exports:{}};return e[n].call(r.exports,r,r.exports,a),r.l=!0,r.exports}return a.m=e,a.c=t,a.d=function(e,t,n){a.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},a.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},a.t=function(e,t){if(1&t&&(e=a(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(a.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)a.d(n,r,function(t){return e[t]}.bind(null,r));return n},a.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return a.d(t,"a",t),t},a.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},a.p="",a(a.s=3)}([function(e,t){e.exports=require("lodash")},function(e,t){e.exports=require("jsonpath-plus")},function(e,t){e.exports=require("errno")},function(e,t,a){const n=a(4).version,r=a(5),s=a(6),o=s.validateFile,i=s.validateExample,p=s.validateExamplesByMap;r.version(n).arguments("<filepath>").description("Validate embedded examples in OpenAPI-JSONs.\n  To validate external examples, use the `-s` and `-e` option.\n  To pass a mapping-file, to validate multiple external examples, use the `-m` option.").option("-s, --schema-jsonpath <schema-jsonpath>","JSON-path to schema, to validate the example file against").option("-e, --example-filepath <example-filepath>","file path to example file, to be validated").option("-m, --mapping-filepath <mapping-filepath>","file path to map, containing schema-paths as key and the file-path(s) to examples as value. If wildcards are used, the parameter has to be put in quotes.").option("-c, --cwd-to-mapping-file","changes to the directory of the mapping-file, before resolving the example's paths. Use this option, if your mapping-files use relative paths for the examples").action((function(e,t){const a=t.schemaJsonpath,n=t.exampleFilepath,r=t.mappingFilepath,s=t.cwdToMappingFile;let l=null;r?(console.log("Validating with mapping file"),l=p(e,r,{cwdToMappingFile:s})):a&&n?(console.log("Validating single external example"),l=i(e,a,n)):(console.log("Validating examples"),l=o(e));!function(e){(function(e){const t=e.responseSchemasWithExamples,a=void 0===t?"-":t,n=e.responseExamplesWithoutSchema,r=void 0===n?"-":n,s=e.responseExamplesTotal,o=void 0===s?"-":s,i=e.matchingFilePathsMapping,p=[`Response schemas with examples found: ${a}`,`Response examples without schema found: ${r}`,`Total examples found: ${o}`];null!=i&&p.push(`Matching mapping files found: ${i}`);process.stdout.write(`${p.join("\n")}\n`)})(e.statistics),e.valid&&(process.stdout.write("\nNo errors found.\n\n"),process.exit(0));process.stdout.write("\nErrors found.\n\n"),process.stderr.write(JSON.stringify(e.errors,null,"    ")),process.exit(1)}(l)})),r.on("--help",()=>{console.log("\n\n  Example for external example-file:\n"),console.log("    $ openapi-examples-validator -s $.paths./.get.responses.200.schema -e example.json openapi-spec.json\n\n")}),r.parse(process.argv)},function(e,t){e.exports={name:"openapi-examples-validator",version:"1.1.2",description:"Validates embedded examples in OpenAPI-JSONs",main:"dist/index.js",engines:{node:">=6"},bin:{"openapi-examples-validator":"dist/cli.js"},scripts:{"start-dev":"babel-node src/cli",build:"npm run build:clean && npm run build:webpack","build:clean":"rimraf dist","build:webpack":"webpack --bail --progress --profile --mode production --config ./webpack/config.babel.js",coverage:'rimraf ./coverage && nyc --reporter=lcov --reporter=text -x "dist/**/*" -x "test/**/*.js" npm test',coveralls:"cat ./coverage/lcov.info | coveralls",test:"npm run build && npm run test:mocha","test:mocha":'BABEL_DISABLE_CACHE=1 mocha --require "@babel/register" --require "./test/util/setup-tests" --recursive "./test/specs/**/*.js"',release:"npm run build && npm run release:stage-artifacts && standard-version -a","release:stage-artifacts":"git add dist/*"},repository:{type:"git",url:"git+https://github.com/codekie/openapi-examples-validator.git"},keywords:["swagger","openapi","json","validate","examples"],author:"Josua Amann",license:"MIT",bugs:{url:"https://github.com/codekie/openapi-examples-validator/issues"},homepage:"https://github.com/codekie/openapi-examples-validator#readme",devDependencies:{"@babel/cli":"^7.6.2","@babel/core":"^7.6.2","@babel/node":"^7.6.2","@babel/preset-env":"^7.6.2","@babel/register":"^7.6.2","@stryker-mutator/core":"2.1.0","babel-eslint":"^10.0.3","babel-loader":"^8.0.6",chai:"^4.2.0",coveralls:"^3.0.6",eslint:"^5.6.1","eslint-loader":"^2.1.1","json-loader":"^0.5.7",mocha:"^5.2.0","mocha-lcov-reporter":"^1.3.0",nyc:"^13.3.0",rimraf:"^2.6.2","standard-version":"^4.4.0","uglifyjs-webpack-plugin":"^2.2.0",webpack:"^4.41.0","webpack-cli":"^3.3.9"},dependencies:{ajv:"6.10.2",commander:"^2.19.0",errno:"0.1.7",glob:"^7.1.4","json-pointer":"0.6.0","jsonpath-plus":"0.18.0",lodash:"^4.17.15"}}},function(e,t){e.exports=require("commander")},function(e,t,a){const n=a(0),r=a(7),s=a(8),o=a(9),i=a(1).JSONPath,p=a(2).custom.createError,l=a(10),c=l.getValidatorFactory,u=l.compileValidate,m=a(13),d=a(16),f=d.ERR_TYPE__JSON_PATH_NOT_FOUND,h=a(17).createValidationResponse,g="schema",x="examples",b=p(f);function v(e){return function(e,t){const a=E(t),n=function(e){return e.reduce((e,t)=>{return e[function(e){const t=i.toPathArray(e).slice(),a=t.lastIndexOf(x);return t.splice(a,t.length-a,g),i.toPathString(t)}(t)]=t,e},{})}(e),r=Object.keys(n),s=O({schemaPaths:r}),o={valid:!0,statistics:s,errors:[]};return r.forEach(e=>{!function({openapiSpec:e,createValidator:t,pathResponseSchema:a,validationMap:n,statistics:r,validationResult:s}){const o=s.errors,p=n[a],l=j(p,e),c=S(a,e,!0),u=P({createValidator:t,responseSchema:c,example:l,statistics:r}).map(e=>(e.examplePath=i.toPointer(i.toPathArray(p)),e));if(!u.length)return;s.valid=!1,o.splice(o.length-1,0,...u)}({openapiSpec:t,createValidator:a,pathResponseSchema:e,validationMap:n,statistics:s,validationResult:o})}),o}(function(e,t){return i({json:e,path:t,resultType:"path"})}(e,m.getImplementation(e).getJsonPathToExamples()),e)}function y(e,t){const a=O({schemaPaths:e}),n=t(a);return h({errors:n,statistics:a})}function O({schemaPaths:e}){return{responseSchemasWithExamples:e.length,responseExamplesTotal:0,responseExamplesWithoutSchema:0}}function j(e,t){return i({json:t,path:e,flatten:!0,wrap:!1,resultType:"value"})}function P({createValidator:e,responseSchema:t,example:a,statistics:n,filePathExample:r}){const s=[];if(n.responseExamplesTotal++,!t)return n.responseSchemasWithExamples--,n.responseExamplesWithoutSchema++,s;const o=u(e(),t);return o(a)?s:s.concat(...o.errors.map(d.create)).map(e=>r?(e.exampleFilePath=r,e):e)}function E(e){return c(e,{allErrors:!0})}function S(e,t,a=!1){const n=j(e,t);if(!a&&!n)throw new b(`Path to response-schema can't be found: '${e}'`,{params:{path:e}});return n}e.exports={default:v,validateFile:function(e){let t=null;try{t=JSON.parse(r.readFileSync(e,"utf-8"))}catch(e){return h({errors:[d.create(e)]})}return v(t)},validateExample:function(e,t,a){let n=null,s=null,o=null;try{n=JSON.parse(r.readFileSync(a,"utf-8")),o=JSON.parse(r.readFileSync(e,"utf-8")),s=S(t,o)}catch(e){return h({errors:[d.create(e)]})}return y([t],e=>P({createValidator:E(o),responseSchema:s,example:n,statistics:e,filePathExample:a}))},validateExamplesByMap:function(e,t,{cwdToMappingFile:a}={}){let i=0;const p=o.sync(t,{nonull:!0}).map(t=>{let o=null,p=null;try{o=JSON.parse(r.readFileSync(t,"utf-8")),p=JSON.parse(r.readFileSync(e,"utf-8"))}catch(e){return h({errors:[d.create(e)]})}return i++,y(Object.keys(o),e=>(function(e,t,a,{cwdToMappingFile:o=!1,dirPathMapExternalExamples:i}){return n(t).entries().flatMap(([t,p])=>{let l=null;try{l=S(t,e)}catch(e){return d.create(e)}return n([p]).flatten().flatMap(t=>{let n=null;try{const e=o?s.join(i,t):t;n=JSON.parse(r.readFileSync(e,"utf-8"))}catch(e){return d.create(e)}return P({createValidator:E(e),responseSchema:l,example:n,statistics:a,filePathExample:t})}).value()}).value()})(p,o,e,{cwdToMappingFile:a,dirPathMapExternalExamples:s.dirname(t)}).map(e=>Object.assign(e,{mapFilePath:t})))});return n.merge(p.reduce((e,t)=>e?function(e,t){return h({errors:e.errors.concat(t.errors),statistics:n.entries(e.statistics).reduce((e,[a,n])=>(e[a]=n+t.statistics[a],e),O({schemaPaths:[]}))})}(e,t):t,null),{statistics:{matchingFilePathsMapping:i}})}}},function(e,t){e.exports=require("fs")},function(e,t){e.exports=require("path")},function(e,t){e.exports=require("glob")},function(e,t,a){const n=a(1).JSONPath,r=a(11),s=a(12),o="$id",i="$..$ref",p="https://www.npmjs.com/package/openapi-examples-validator/defs.json",l="https://www.npmjs.com/package/openapi-examples-validator/schema.json";function c(e){n({path:i,json:e,callback(e,t,a){e.startsWith("#")&&(a.parent[a.parentProperty]=`${p}${e}`)}})}e.exports={getValidatorFactory:function(e,t){const a=function(e){const t={[o]:p};return n({path:i,json:e,callback(a){if(!a.startsWith("#"))return;const n=a.substring(1),s=r.get(e,n);r.set(t,n,s)}}),t}(e);return()=>{const e=new s(t);return e.addSchema(a),e}},compileValidate:function(e,t){const a=function(e,t){const a=Object.assign({},e);return a[o]=t,a}(t,l);return c(a),e.compile(a)}}},function(e,t){e.exports=require("json-pointer")},function(e,t){e.exports=require("ajv")},function(e,t,a){const n=a(14),r=a(15),s=/^3\./;e.exports={getImplementation:function(e){if("string"==typeof e.swagger)return n;if(e.openapi&&e.openapi.match(s))return r;return null}}},function(e,t){const a="$..examples.application/json";e.exports={getJsonPathToExamples:function(){return a}}},function(e,t){const a="$..responses..content.application/json.examples..value";e.exports={getJsonPathToExamples:function(){return a}}},function(e,t,a){function n(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}const s=a(0),o=a(2).code.ENOENT;class i{static create(e){const t=i.ERR_TYPE__VALIDATION,a=e.code,n=e.message,r=e.path,o=e.cause,p=a||e.type||t,l={message:n};return t===p?s.merge(l,e):(r&&s.merge(l,{params:{path:r}}),o&&s.merge(l,o)),new i(p,l)}constructor(e,t={}){Object.assign(this,function(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?n(a,!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):n(a).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}({type:e},t))}}e.exports=i,i.ERR_TYPE__VALIDATION="Validation",i.ERR_TYPE__JSON_PATH_NOT_FOUND="JsonPathNotFound",i.ERR_TYPE__JS_ENOENT=o.code},function(e,t){e.exports={createValidationResponse:function({errors:e,statistics:t={}}){return{valid:!e.length,statistics:t,errors:e}}}}]);
//# sourceMappingURL=cli.js.map